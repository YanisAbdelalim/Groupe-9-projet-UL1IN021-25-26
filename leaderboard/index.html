<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Classement</title>
    <link rel="stylesheet" href="style_index.css">
</head>
<body>
    <div class="flex">
    <img src="light.gif" id="gif">
    <h1 id="titre">AJOUTER UN SCORE</h1>
    </div>

    <div class="flex">
        <div id="input">
            <label >Nom :</label><br>
            <input type="text" id="nom" placeholder="Votre nom"><br>
            <label>Score :</label><br>
            <input type="number" id="score" placeholder="Votre score"><br>
            <button id="envoyer">Envoyer</button>
        </div>

        <div id="classement">
            <h2>Classement</h2>
        
            <table id="leaderboard">
                <thead>
                    <tr>
                        <th>Rang</th>
                        <th>Nom</th>
                        <th>Score</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    
    <script>
        const envoyerBtn = document.getElementById('envoyer');
        const nomInput = document.getElementById('nom');
        const scoreInput = document.getElementById('score');
        const tbody = document.querySelector('#leaderboard tbody');

        (function prefillScoreFromQuery(){
            const params = new URLSearchParams(window.location.search);
            const gameScore = params.get('score');
            if (gameScore !== null && gameScore !== '') {
                scoreInput.value = parseInt(gameScore, 10) || 0;
                scoreInput.style.display = 'none';
                const display = document.createElement('div');
                display.id = 'score_display';
                display.textContent = `${scoreInput.value}`;
                display.style = 'font-size:1.2rem; margin-top:8px; color: #e6b88e;';
                document.getElementById('input').insertBefore(display, scoreInput.nextSibling);
                nomInput.focus();
            }
        })();

        function chargerLeaderboard() {
            fetch('get_scores.php')
                .then(response => response.json())
                .then(data => {
                    tbody.innerHTML = '';
                    data.forEach((item, index) => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${index + 1}</td>
                            <td>${item.nom_joueur}</td>
                            <td>${item.score}</td>
                            <td>${item.date_score}</td>
                        `;
                        tbody.appendChild(tr);
                    });
                });
        }

        envoyerBtn.addEventListener('click', () => {
            const nom = nomInput.value.trim();
            const score = parseInt(scoreInput.value, 10);

            if (!nom || isNaN(score)) {
                alert('Veuillez entrer un nom et un score valides.');
                return;
            }

            fetch('save_score.php', {
                method: 'POST',
                headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                body: `nom_joueur=${encodeURIComponent(nom)}&score=${encodeURIComponent(score)}`
            })
            .then(response => response.text())
            .then(data => {
                console.log(data);
                chargerLeaderboard();
                nomInput.value = '';
                scoreInput.value = '';
                const display = document.getElementById('score_display');
                if (display) display.remove();
            })
            .catch(err => console.error(err));
        });
        chargerLeaderboard();
    </script>
</body>
</html>




